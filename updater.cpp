#include "updater.h"
#include <QDir>
#include <QFile>
#include <QCoreApplication>
#include <QDebug>

#include <unistd.h>

Updater::Updater(QObject *parent) : QObject(parent)
{

}

void Updater::update()
{
    QDir d;

    // Get the application name
    QString appName = QCoreApplication::arguments().first();
    QString newAppName = appName;
    newAppName = newAppName.replace("-running", "");
    qDebug() << d.entryList();
    if (QFile::exists(newAppName)) {
        // Remove the current file
        QFile::remove(appName);

        // Rename new app file
        QFile::rename(newAppName, appName);

        // TODO: This should be dynamically build using QCoreApplication:arguments
        char *args[] = {
            "./qt-execve-test-running", NULL
        };

        // Restart the application
        execve(appName.toStdString().c_str(),
               (char *const *)(&args),
               nullptr);
    } else {
        qDebug() << "Nothing to do!";
    }
}
